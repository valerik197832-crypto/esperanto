<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Espero Admin Visual Helper</title>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 1000px; margin: 0 auto; background: #f4f7f9; color: #333; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        textarea { width: 100%; height: 120px; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; transition: border 0.3s; }
        textarea:focus { border-color: #007bff; outline: none; }
        
        button { margin-top: 15px; padding: 15px 30px; background: #007bff; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 16px; }
        button:hover { background: #0056b3; }

        /* –í–ò–ó–£–ê–õ–¨–ù–´–ô –†–ï–î–ê–ö–¢–û–† */
        .preview-area { 
            margin-top: 25px; 
            padding: 20px; 
            background: #fff; 
            border: 1px solid #eee; 
            border-radius: 8px; 
            line-height: 1.8; 
            font-size: 18px;
            white-space: pre-wrap; /* –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ */
        }
        
        /* –¶–≤–µ—Ç–∞ –ø–æ–¥—Å–≤–µ—Ç–∫–∏ */
        .w-new { background-color: #ffdce0; color: #d9534f; padding: 2px 4px; border-radius: 4px; font-weight: bold; border-bottom: 2px solid #d9534f; }
        .w-ok { color: #28a745; border-bottom: 1px solid #28a74533; }

        .legend { margin-top: 10px; font-size: 14px; }
        .code-box { background: #2d2d2d; color: #7fdbff; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 14px; white-space: pre-wrap; margin-top: 10px; border: 1px solid #000; overflow-x: auto; }
        h3 { margin-top: 30px; margin-bottom: 10px; border-left: 5px solid #007bff; padding-left: 10px; }
    </style>
</head>
<body>

<div class="card">
    <h1>üë®‚Äçüíª –í–∏–∑—É–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ Espero</h1>
    <p>–í—Å—Ç–∞–≤—å —Ç–µ–∫—Å—Ç –Ω–∞ –≠—Å–ø–µ—Ä–∞–Ω—Ç–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:</p>
    <textarea id="textInput" placeholder="Vivis unu tre kolerema juna viro..."></textarea>
    <button onclick="processText()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—Å—Ç</button>

    <div id="visualPreview" class="preview-area" style="display:none;"></div>
    
    <div class="legend" id="legend" style="display:none;">
        <span style="color: #28a745;">‚óè –ï—Å—Ç—å –≤ –±–∞–∑–µ</span> | 
        <span style="color: #d9534f; font-weight: bold;">‚óè –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å</span>
    </div>

    <div id="codeResults"></div>
</div>

<!-- –ü–û–î–ö–õ–Æ–ß–ê–ï–ú –¢–ï–ö–£–©–£–Æ –ë–ê–ó–£ -->
<script src="languages/base.js"></script>

<script>
    function processText() {
        const input = document.getElementById('textInput').value;
        if (!input.trim()) return;

        if (typeof LEGO_BASE === 'undefined') {
            alert("–û—à–∏–±–∫–∞: –§–∞–π–ª languages/base.js –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –ø—É—Å—Ç–æ–π!");
            return;
        }

        // –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –Ω–∞ —Å–ª–æ–≤–∞ –∏ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã
        // –£—á–∏—Ç—ã–≤–∞–µ—Ç –±—É–∫–≤—ã –≠—Å–ø–µ—Ä–∞–Ω—Ç–æ: a-z –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
        const tokens = input.split(/([a-zƒâƒùƒ•ƒµ≈ù≈≠A-Zƒàƒúƒ§ƒ¥≈ú≈¨]+)/);

        let htmlPreview = "";
        let missingWordsSet = new Set();
        let foundCount = 0;

        tokens.forEach(token => {
            // –ï—Å–ª–∏ —ç—Ç–æ —Å–ª–æ–≤–æ (–±—É–∫–≤—ã)
            if (/^[a-zƒâƒùƒ•ƒµ≈ù≈≠A-Zƒàƒúƒ§ƒ¥≈ú≈¨]+$/.test(token)) {
                let lowWord = token.toLowerCase();
                if (LEGO_BASE[lowWord]) {
                    htmlPreview += `<span class="w-ok">${token}</span>`;
                    foundCount++;
                } else {
                    htmlPreview += `<span class="w-new">${token}</span>`;
                    missingWordsSet.add(lowWord);
                }
            } else {
                // –ï—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ–±–µ–ª, —Ç–æ—á–∫–∞, –∑–∞–ø—è—Ç–∞—è ‚Äî –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å
                htmlPreview += token;
            }
        });

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∏–∑—É–∞–ª—å–Ω—ã–π –±–ª–æ–∫
        const preview = document.getElementById('visualPreview');
        preview.innerHTML = htmlPreview;
        preview.style.display = "block";
        document.getElementById('legend').style.display = "block";

        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–æ–¥—ã
        const missingWords = Array.from(missingWordsSet);
        let out = document.getElementById('codeResults');
        
        if (missingWords.length === 0) {
            out.innerHTML = `<h3>‚úÖ –í—Å—ë –≥–æ—Ç–æ–≤–æ!</h3><p>–í—Å–µ —Å–ª–æ–≤–∞ –∏–∑ —ç—Ç–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ —É–∂–µ –µ—Å—Ç—å –≤ —Ç–≤–æ–∏—Ö —Å–ª–æ–≤–∞—Ä—è—Ö.</p>`;
        } else {
            let baseCode = "";
            let langCode = "";

            missingWords.forEach(w => {
                let cap = w.charAt(0).toUpperCase() + w.slice(1);
                baseCode += `    '${w}': { word: '${cap}', parts: ['${cap}'] },\n`;
                langCode += `    '${w}': { text: '', roots: [''] },\n`;
            });

            out.innerHTML = `
                <h3>üö® –ù–æ–≤—ã–µ —Å–ª–æ–≤–∞ (${missingWords.length})</h3>
                <p>–î–æ–±–∞–≤—å –≤ <b>languages/base.js</b>:</p>
                <div class="code-box">${baseCode}</div>

                <p>–ó–∞–≥–æ—Ç–æ–≤–∫–∏ –¥–ª—è <b>ru.js, en.js</b> –∏ –¥—Ä.:</p>
                <div class="code-box" style="color: #ecc48d;">${langCode}</div>
            `;
        }
    }
</script>

</body>
</html>